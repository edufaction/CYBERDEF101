%-------------------------------------------------------------
%               FR CYBERDEF SECOPS COURSE
%                                  EDX PACKAGES
%.    Commons COMMANDS for BOOK, NOTES (.doc) 
%                            and BEAMER (.prz)
%                              2020 eduf@ction
%-------------------------------------------------------------

\newcommand{\ucite}[1]{\cite{#1}}
%\newcommand{\ucite}[1]{REF BIB #1}
\newcommand{\ugls}[1]{\gls{#1}}
%\newcommand{\ugls}[1]{GLOSSAIRE (#1)}
\newcommand{\uac}[1]{\acrshort{#1}}



% \newcommand{\ExtractBeforeLastSlash}[1]{\directlua{extract_before_last_slash("#1")}}
% \newcommand{\ExtractAfterLastSlash}[1]{\directlua{extract_after_last_slash("#1")}}
% \newcommand{\RemoveExtension}[1]{\directlua{remove_extension("#1")}}
% \newcommand{\ExtractExtension}[1]{\directlua{extract_extension("#1")}}


\newcommand{\includepicturesubpath}[1]
{#1}

%{\ExtractBeforeLastSlash{#1}/\upicturethemepath\RemoveExtension{\ExtractAfterLastSlash{#1}}.\ExtractExtension{#1}}
    

%---------------------------------------------------
%										 	AUDIO NOTE 
%---------------------------------------------------

\newcommand\audionote[2]{%
  \note{#2}
  \immediate\write\audioexport{==AudioSlide=============}
  \immediate\write\audioexport{#1}
  \immediate\write\audioexport{\insertframenumber}
  \immediate\write\audioexport{---------------------------------}
  \immediate\write\audioexport{#2}
  \immediate\write\audioexport{---------------------------------}
}%

%---------------------------------------------------
%										 	TEXT STYLE SHORTCUT 
%---------------------------------------------------

\newcommand{\tcb}[1]{\textbf{\textcolor{uMainColor}{#1}}}

\newcommand{\voir}[1]{(Schéma~\ref{#1},~page~\pageref{#1}}

\newcommand{\graphicxextension}{pdf}

\newcommand\myemptypage{
   
    \thispagestyle{empty}
    \addtocounter{page}{-1}
    \newpage
  \null
    %CECI EST UNE PAGE VIDE
       \vfill
    }


\newcommand{\uNA}[2]
{
\newacronym{a#1}{#1}{#2}
}

\newcommand{\coauthor}[4]
{
\noindent (#2) \textbf{#1} - #4 : \textit{#3}
}


\newcommand\UKword[1]{\emph{#1}\xspace}
\newcommand\textUK[1]{\textit{\textbf{#1}}\xspace}
\newcommand\Ucenter[1]{\begin{center}{#1}\end{center}}

\newcommand\head[1]{\textbf{#1}}
\newcommand\tb[1]{\textbf{#1}}
\newcommand{\g}[1]{\og #1 \fg{}}
\newcommand{\uload}[1] {\input{../Latex/#1}}
\newcommand{\ucurcolor}{black}

\newcommand{\mak}[1]{\faicon{\aArrowCircleORight} #1}


%-----------------------------------------------------
%										 	\INFOGitHub 
%---------------------------------------------------


\newcommand{\GITfilename}{https://github.com/edufaction/CYBERDEF101/raw/main/Release/Builder/\jobname.pdf}

%\newcommand{\safeqrcode}[2][]{%
%\qrcode[#1]{\detokenize{#2}} }

\newcommand{\safeqrcode}[2][]{\qrcode[#1]{#2}} 

\newcommand{\INFOGitHub}
{
\begin{center} 
\setstretch{1.5}
 {Vérifiez la disponibilité d'une version plus récente de} \\
 {\ulink{\GITfilename}{\textbf{\jobname.pdf }sur GITHUB CYBERDEF} }   \\ 
{{\huge\ccbyncndeu}}  \\  
{Publication en \href{https://creativecommons.org/licenses/by-nc-nd/2.0/fr/}{Creative Common BY-NC-ND} by eduf@ction}    \\  % Copyright notice
{\safeqrcode[height=4 cm,padding]{\GITfilename}}  
\end{center} 
}

\newcommand{\INFOGitHubS}
{
\noindent{\safeqrcode[height=3 cm]{\GITfilename}} \\
\noindent {\tiny Téléchargez une version à jour} 
}



%-----------------------------------------------------
%										 	\upspicture 
%---------------------------------------------------
\newcommand{\upspicture}[3]
{
\renewcommand{\ucurcolor}{#3}
\resizebox{#2\textwidth}{!}{\input{../#1}}
}


%-----------------------------------------------------
%										 	\uindex 
%---------------------------------------------------


\newcommand{\uindex}[1]
{
#1\index{#1}\xspace
}

\newcommand{\ulindex}[1]{\index{#1}}

%-----------------------------------------------------
%										 	\includer 
%---------------------------------------------------

\newcommand{\includer}[1]
{
\input{../Latex/Sources/EDU/SRC1/Chapters/#1}
}

%-----------------------------------------------------
%										 	\edxdico 
%---------------------------------------------------

\newcommand{\edxdico}[2] {\textbf{#1}:\textit{#2} \index{#1}}

%-----------------------------------------------------
%  command DEF : InTextx
%-----------------------------------------------------
\newcommand\InTexta{no text}
\newcommand\InTextb{no text}
\newcommand\InTextc{no text}
\newcommand\rnc{\renewcommand}


%-----------------------------------------------------
%										 	ENV warningbox
%---------------------------------------------------

\newtcolorbox{warningbox}[2][]
{
  colframe = uMainColor!25,
  colback  = black!05,
  coltitle = uMainColor!20!black,
  fonttitle = \bfseries, 
  title    = #2,
  #1,
}


\newtcolorbox{techworkbox}[2][]{sharp corners,colframe = uMainColor!25,colback  = black!05,coltitle = uMainColor!20!black,fonttitle = \bfseries, title={\textcolor{uMainColor}{\faFile~\small {Sujet de mémoire SECOPS}}} : #2,#1,}


\newtcolorbox{notebox2}[2][]
{
sharp corners, 
colback = uMainColor!5!white, 
colframe = uMainColor!75!black,
fonttitle = \bfseries, 
colbacktitle= uMainColor!85!black,
title=#2,#1
}

\newtcolorbox{notebox}[2][]{colback=uMainColor!5!white,
colframe=uMainColor!75!black,fonttitle=\bfseries,
colbacktitle=uMainColor!85!black,enhanced,
attach boxed title to top right={yshift=+1mm},
title=#2,#1}


\newtcolorbox{toolsboxin}[2][]{sharp corners, colback=uMainColor!0!white,
colframe= black!25,fonttitle=\bfseries,
colbacktitle=black!60,enhanced,
attach boxed title to top left={yshift=+1mm},
title=#2,#1}


\newtcolorbox{techworkin}[2][]{sharp corners, colback=uMainColor!5!white,
colframe= uMainColor!100, fonttitle=\bfseries,
colbacktitle=black!5, enhanced,
 coltitle=black!50,
attach boxed title to top right ={yshift=+1mm},
title=#2,#1}



%-----------------------------------------------------
%										 	ENV ToolsBox
%---------------------------------------------------


\newcommand\tooleditor{No EDITOR in Datas.tex}
\newcommand\toolurl{No URL INSERTED in Datas.tex}
\newcommand\toolclass{No EDITOR in Datas.tex}
\newcommand\toolname{No NAME in Datas.tex}
\newcommand\toolanalyst{No ANALYST in Datas.tex}

\newcommand{\toolsbox}[2]
{
\input{../Latex/Sources/EDU/SRC1/SecComponents/#2.#1/datas.tex} 
\begin{toolsboxin}[sidebyside,righthand width=.7\textwidth]{#1}
\includegraphics[width=0.9\textwidth]{../Latex/Sources/EDU/SRC1/SecComponents/#2.#1/icon.png} \\
\tcblower
\input{../Latex/Sources/EDU/SRC1/SecComponents/#2.#1/description.tex}
\end{toolsboxin}
\noindent \small {\faCogs~Classe : \uppercase{\textbf{#2}}, Site de référence : \textbf{\ulink{\toolurl}{#1}}}
\newline
\small {\faGlobe~Editeur : \textbf{\tooleditor}}
\small {\faEye~Analyste : \textbf{\toolanalyst}}
}

%\renewcommand\toolsclass{SIEM}
%\renewcommand\toolsname{RSA Netwitness}
%\renewcommand\toolseditor{RSA}
%\renewcommand\toolsurl{https://www.rsa.com/fr-fr/products/threat-detection-response}

%-----------------------------------------------------
%										 	ENV  TechWork
%---------------------------------------------------


\newcommand{\techwork}[2]
{
\begin{techworkin} [righthand width=.8\textwidth]{\faCogs~\small {Fiche TECHNO} : #1}#2
\end{techworkin}
}

%-----------------------------------------------------
%										 	\uchap
%---------------------------------------------------
\ifdefined\INTERTITLE
\providecommand{\uchap}[1]
	{
	\begin{LARGE}
	\textbf{\Ucenter{#1 \\ -oOo-}}	
	\end{LARGE}
	}
\else
	\providecommand{\uchap}[1]{}
\fi

%-----------------------------------------------------
%											\uexpand
%---------------------------------------------------
\newcommand {\uexpand}[1]{
\mode<all>\input{../Latex/Sources/EDU/SRC1/Chapters/#1}
}


%-----------------------------------------------------
%											\spicture 
% direct include graphic with Scrivener
%-----------------------------------------------------

\newcommand{\spicture}[3]{
\begin{figure}[!hbtp] %h !hbtp
  \begin{center}
	 \includegraphics[width=0.8\textwidth]{#1}
  \end{center}
\caption{#3 - (slbl-#2)\label{slbl-#2}}
\end{figure}
}

%\StrBefore{#2}{.pdf}

%-----------------------------------------------------
%											\upicture 
%---------------------------------------------------

\ifdefined\PRZMODE

\providecommand{\upicture}[4]{
\framesubtitle{#2}
%\begin{figure}[!h] %h
  \begin{center}
	 \includegraphics[height=#3\textheight, width=#3\textwidth, keepaspectratio ]{\includepicturesubpath{#1.pdf}}
  \end{center}
%  \end{figure}
}

\else

\providecommand{\upicture}[4]{
\begin{figure}[!hbtp] %h !hbtp
  \begin{center}
	 \includegraphics[width=#3\textwidth]{\includepicturesubpath{#1.pdf}}
  \end{center}
\caption{#2 \label{#4}}
\end{figure}
}
	
\fi


\ifdefined\PRZMODE

\providecommand{\uwpicture}[4]{
\framesubtitle{#2}
%\begin{figure}[!h] %h
  \begin{center}
	 \includegraphics[height=0.8\textheight, width=0.8\textwidth, keepaspectratio ]{\includepicturesubpath{#1.pdf}}
  \end{center}
%  \end{figure}
}
\else
\providecommand{\uwpicture}[4]
{
\begin{wrapfigure}{O}{#3\textwidth} % inside / Outside
  \begin{center}
	 \includegraphics[width=#3\textwidth]{\includepicturesubpath{#1.pdf}}
\end{center}
\caption{#2 \label{#4}}
\end{wrapfigure}
}
\fi

%-----------------------------------------------------
%	\picframe for BEAMER (Image included in Beamer Slide)
%---------------------------------------------------

\ifdefined\PRZMODE

\providecommand{\picframe}[4]
{
\begin{frame}
\frametitle<presentation>{#2}
  \begin{center}

   \begin{tikzpicture}[remember picture, overlay]
    \node at (current page.center) {\includegraphics[width=#3\paperwidth, height=#3\paperheight,keepaspectratio]{\includepicturesubpath{#1.pdf}}};
    \end{tikzpicture}

  \end{center}
\end{frame}

}
\else
\providecommand{\picframe}[4]
{
\begin{figure}[!hbtp] % !hbtp ou !h 
\centering 
%{\includegraphics[width=#3\paperwidth, height=#3\paperheight,keepaspectratio]{\includepicturesubpath{#1.pdf}}}
\includegraphics[width=#3\textwidth]{\includepicturesubpath{#1.pdf}}
\caption{#2 \label{#4}}
\end{figure}
}
\fi

%-----------------------------------------------------
%.  for BEAMER (Image included in Beamer Slide)
%	\picframeS Simplified with Name and Label from One Param
%---------------------------------------------------


\ifdefined\PRZMODE

\providecommand{\picframeS}[2]
{
\begin{frame}
\frametitle<presentation>{#2}
  \begin{center}
	 \includegraphics[height=0.95\textheight, width=0.95\textwidth, keepaspectratio ]{\picpath/img-#1.\graphicxextension}
  \end{center}
\end{frame}

}
\else
\providecommand{\picframeS}[2]
{
\begin{figure}[!hbtp] % !hbtp ou !h 
\centering \includegraphics[width=0.9\textwidth]{\picpath/img-#1.\graphicxextension}
\caption{(s) #2 \label{lbl:#1}}
\end{figure}
}

\fi


%{figure}[!h]
%{wrapfigure}{O}{#3\textwidth}
%-----------------------------------------------------
%	FRAME			\wpicframe 
%---------------------------------------------------

\ifdefined\PRZMODE

\providecommand{\wpicframe}[4]
{
\begin{frame}
\frametitle<presentation>{#2}
  \begin{center}
	 \includegraphics[height=0.95\textheight, width=0.95\textwidth, keepaspectratio ]{#1.\graphicxextension}
  \end{center}
\end{frame}

}
\else
\providecommand{\wpicframe}[4]
{
\begin{wrapfigure}{O}{#3\textwidth}
\centering \includegraphics[width=#3\textwidth]{#1.\graphicxextension}
\caption{#2 \label{#4}}
\end{wrapfigure}
}
\fi

%-----------------------------------------------------
%	FRAME										\texframe 
%---------------------------------------------------
\ifdefined\PRZMODE

\providecommand{\texframe}[3]
{
\begin{frame}
\frametitle<presentation>{#1}
\framesubtitle<presentation>{#2}
#3
\end{frame}
}
\else
\providecommand{\texframe}[3]
{
#3
}

\fi

%-----------------------------------------------------
%											\uref 
%---------------------------------------------------
%\newcommand{\uref}[2]{(Voir~#1~\cref{#2} page~\pageref{#2})}

\newcommand{\uref}[2]{(Voir~#1~\ref{#2} page~\pageref{#2})}
%-----------------------------------------------------
%											\ubg
%---------------------------------------------------
\newcommand{\ubg}[1]{
\textbf{\g{\uppercase{#1}}}
}
%-----------------------------------------------------
%											\updfimage 
%---------------------------------------------------

\newcommand{\updfimage}[3]
{
\begin{wrapfigure}{R}{#3\textwidth}
  \begin{center}
	 \resizebox{#3\textwidth}{!}{\includegraphics{\includepicturesubpath{#1.pdf}}}
  \end{center}
\caption{#2}
\end{wrapfigure}
}


%************************PACKAGE***

%\usepackage{tikz}% Required for drawing custom shapes
\usetikzlibrary{shadows}


%-----------------------------------------------------
%											 		\rem 
% insertion d'une remarque avec R
%---------------------------------------------------
\newcommand\rem[1]{%
   \marginpar{%
   \tikzpicture[baseline={(title.base)}]
      \node[inner sep=5pt,text width=4cm,drop shadow={shadow yshift=-5pt,shadow xshift=5pt,uMainColor},fill=white] (box) {\vskip5pt \nointerlineskip #1};
      \node[right=10pt,inner sep=0pt,outer sep=10pt] (title) at (box.north west) {\bfseries\color{uMainColor}Remarque};
      \draw[draw=uMainColor,very thick](title.west)--(box.north west)--(box.south west)--(box.south east)--(box.north east)--(title.east);
      \fill[uMainColor]([yshift=-10pt]box.north west)--+(-5pt,-5pt)--+(0pt,-10pt);
   \endtikzpicture}%
}
%-----------------------------------------------------
%											 \utikzimage 
% insertion d'une image sur fichier tkz.tex
%---------------------------------------------------

\newcommand{\utikzimage}[3]
{
\begin{wrapfigure}{R}{#3\textwidth}
  \begin{center}
	 \resizebox{#3\textwidth}{!}{\input{../#1.tkz.tex}}
  \end{center}
\caption{#2}
\end{wrapfigure}
}

%-----------------------------------------------------
%														\link 
% Url et footnote du lien
%-----------------------------------------------------

% TT every character and hyphenate after it
\def\hyphenateAndTtWholeString #1{\xHyphenate#1$\wholeString\unskip}

\def\xHyphenate#1#2\wholeString {\if#1$%
    \else\transform{#1}%
    \takeTheRest#2\ofTheString\fi}

\def\takeTheRest#1\ofTheString\fi
{\fi \xHyphenate#1\wholeString}

\def\transform#1{\url{#1}\hskip 0pt plus 1pt}

% Define the \urlx command which works like \url, but with line brakes
\def\urlx #1{\href{#1}{\hyphenateAndTtWholeString{#1}}}
  

 %-----------------------------------------------------
%														\link 
%-----------------------------------------------------  
  
  \newcommand{\ulink}[2]
  {\href{#1}
  {#2~\raisebox{-0.2ex}{\faExternalLink}\footnote{\url{#1}}}\xspace}
  
  \newcommand{\wikipedia}[1]
  { \href{https://fr.wikipedia.org/wiki/#1}{\textcolor{grey}{#1}}\raisebox{0.5ex}{\tiny{\textcolor{uMainColor}{\faWikipediaW}}}}
  


 %-----------------------------------------------------
%														\utodo 
%-----------------------------------------------------

  \newcommand{\utodo}{\begin{center}{\noindent \textcolor{cyan}{\faGears~{En cours de rédaction, DRAFT non publiable} \faGears}}\end{center}}
  
    \newcommand{\utocomplete}{\begin{center}{\noindent \textcolor{blue}{\faClipboard~{à compléter, les éléments ne donnent qu'une vue trop réduite ou trop parcellaire du sujet}}}\end{center}}
  

 



